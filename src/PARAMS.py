# src/PARAMS.py

#####################
# 데이터 경로 설정  #
#####################
TRAIN_PATH = "./data/train.csv"
TEST_PATH = "./data/test.csv"

######################################
# 전처리 시 기본적으로 적용할 전략  #
######################################
DEFAULT_NUMERIC_IMPUTE = "mean"   # ["mean", "median", "zero", "drop"] 등
DEFAULT_OHE_IMPUTE = "none"       # One-Hot할 컬럼에서 결측치가 나오면 어떻게 처리할지
DEFAULT_BINARY_IMPUTE = "zero"    # 0/1 피처에서 결측치 나오면 0으로
DEFAULT_INT_IMPUTE = "zero"       # int형에서 결측치 나오면 0으로

# 라벨(임신 성공 여부) 컬럼명
TARGET_COL = "임신 성공 여부"

#####################
# 전체 피처 정의    #
#####################
#
#  key   : 실제 CSV상의 컬럼명
#  value : ( "처리방식", "결측치대체방식" )
#           처리방식 예: "OHE", "INT", "BINARY", "SPECIAL", "drop" 등
#           결측치 대체방식 예: "mean", "zero", "none", "drop" ...
#

FULL_FEATURES = {
    # 예) ID는 학습에 사용하지 않을 경우 drop
    "ID": ("drop", None),

    # 시술 시기 코드 → One-Hot, 결측치: zero(혹은 none) 처리
    "시술 시기 코드": ("OHE", DEFAULT_OHE_IMPUTE),

    # 시술 당시 나이 → One-Hot, 결측치 없음으로 가정
    "시술 당시 나이": ("OHE", "none"),

    # 임신 시도 또는 마지막 임신 경과 연수 → int, 결측 시 zero로
    "임신 시도 또는 마지막 임신 경과 연수": ("INT", "zero"),

    # 시술 유형 [DI, IVF] → One-Hot
    "시술 유형": ("OHE", "none"),

    # **특정 시술 유형**: 슬래시/콜론 파싱으로 멀티핫 & 별도 카운트
    "특정 시술 유형": ("SPECIAL", "none"),

    # 배란 자극 여부 [0,1] → BINARY, 비어있으면 0
    "배란 자극 여부": ("BINARY", "zero"),

    # 배란 유도 유형 → 사용 안 함
    "배란 유도 유형": ("drop", None),

    # 단일 배아 이식 여부 [0,1] → BINARY, 비어있으면 0
    "단일 배아 이식 여부": ("BINARY", "zero"),

    # 착상 전 유전 검사 사용 여부 [0,1]
    "착상 전 유전 검사 사용 여부": ("BINARY", "zero"),

    # 착상 전 유전 진단 사용 여부 [0,1]
    "착상 전 유전 진단 사용 여부": ("BINARY", "zero"),

    # 남성/여성/부부 주/부 불임 원인, 불명확, 불임 원인 - 난관 질환 등 → 모두 BINARY
    "남성 주 불임 원인": ("BINARY", "zero"),
    "남성 부 불임 원인": ("BINARY", "zero"),
    "여성 주 불임 원인": ("BINARY", "zero"),
    "여성 부 불임 원인": ("BINARY", "zero"),
    "부부 주 불임 원인": ("BINARY", "zero"),
    "부부 부 불임 원인": ("BINARY", "zero"),
    "불명확 불임 원인": ("BINARY", "zero"),
    "불임 원인 - 난관 질환": ("BINARY", "zero"),
    "불임 원인 - 남성 요인": ("BINARY", "zero"),
    "불임 원인 - 배란 장애": ("BINARY", "zero"),
    "불임 원인 - 여성 요인": ("BINARY", "zero"),
    "불임 원인 - 자궁경부 문제": ("BINARY", "zero"),
    "불임 원인 - 자궁내막증": ("BINARY", "zero"),
    "불임 원인 - 정자 농도": ("BINARY", "zero"),
    "불임 원인 - 정자 면역학적 요인": ("BINARY", "zero"),
    "불임 원인 - 정자 운동성": ("BINARY", "zero"),
    "불임 원인 - 정자 형태": ("BINARY", "zero"),

    # 배아 생성 주요 이유 → One-Hot
    "배아 생성 주요 이유": ("OHE", "none"),

    # 총 시술 횟수 → One-Hot
    "총 시술 횟수": ("OHE", "none"),

    # 클리닉 내 총 시술 횟수 → One-Hot
    "클리닉 내 총 시술 횟수": ("OHE", "none"),

    # IVF 시술 횟수, DI 시술 횟수, 총/IVF/DI 임신 횟수, 총/IVF/DI 출산 횟수 → 모두 One-Hot
    "IVF 시술 횟수": ("OHE", "none"),
    "DI 시술 횟수": ("OHE", "none"),
    "총 임신 횟수": ("OHE", "none"),
    "IVF 임신 횟수": ("OHE", "none"),
    "DI 임신 횟수": ("OHE", "none"),
    "총 출산 횟수": ("OHE", "none"),
    "IVF 출산 횟수": ("OHE", "none"),
    "DI 출산 횟수": ("OHE", "none"),

    # 총 생성 배아 수 등 int → 결측치 처리: mean or drop 등
    "총 생성 배아 수": ("INT", "zero"),
    "미세주입된 난자 수": ("INT", "zero"),
    "미세주입에서 생성된 배아 수": ("INT", "zero"),
    "이식된 배아 수": ("INT", "zero"),
    "미세주입 배아 이식 수": ("INT", "zero"),
    "저장된 배아 수": ("INT", "zero"),
    "미세주입 후 저장된 배아 수": ("INT", "zero"),
    "해동된 배아 수": ("INT", "zero"),
    "해동 난자 수": ("INT", "zero"),
    "수집된 신선 난자 수": ("INT", "zero"),
    "저장된 신선 난자 수": ("INT", "zero"),
    "혼합된 난자 수": ("INT", "zero"),
    "파트너 정자와 혼합된 난자 수": ("INT", "zero"),
    "기증자 정자와 혼합된 난자 수": ("INT", "zero"),

    # 난자 출처, 정자 출처, 난자/정자 기증자 나이 → One-Hot
    "난자 출처": ("OHE", "none"),  # 결측 → "알 수 없음"으로 처리해줄 수도 있음
    "정자 출처": ("OHE", "none"),
    "난자 기증자 나이": ("OHE", "none"),
    "정자 기증자 나이": ("OHE", "none"),

    # 동결/신선/기증 배아 사용 여부, 대리모, PGD/PGS 시술 여부 → [0,1], 결측 mean or zero
    "동결 배아 사용 여부": ("BINARY", "zero"),
    "신선 배아 사용 여부": ("BINARY", "zero"),
    "기증 배아 사용 여부": ("BINARY", "zero"),
    "대리모 여부": ("BINARY", "zero"),
    "PGD 시술 여부": ("BINARY", "zero"),
    "PGS 시술 여부": ("BINARY", "zero"),

    # 난자 채취 경과일, 난자 해동 경과일, 배아 해동 경과일 → 삭제
    "난자 채취 경과일": ("drop", None),
    "난자 해동 경과일": ("drop", None),
    "배아 해동 경과일": ("drop", None),
    # "난자 채취 경과일": ("drop", None),
    # "난자 해동 경과일": ("drop", None),
    # "배아 해동 경과일": ("drop", None),
    

    # 난자 혼합 경과일 → 0~7, 범주화(0,1,2이상) → One-Hot
    "난자 혼합 경과일": ("OHE", "none"),

    # 배아 이식 경과일 → 0~7, 결측이면 3으로 → 그 뒤 One-Hot
    "배아 이식 경과일": ("OHE", "special_fill_3"),

    # 임신 성공 여부 [0,1] (타겟)
    "임신 성공 여부": ("drop", None),  # 실제 학습시 y로 분리하므로 drop
}

#################################
# 실제로 학습에 사용할 FEATURES #
#################################

#"배아 생성 주요 이유"
FEATURES = [
    "시술 시기 코드", ##
    "시술 당시 나이", 
    "임신 시도 또는 마지막 임신 경과 연수",
    "시술 유형",
    #"특정 시술 유형",
    #"배란 자극 여부",
    #"단일 배아 이식 여부",
    #"착상 전 유전 검사 사용 여부",
    "착상 전 유전 진단 사용 여부",
    #"남성 주 불임 원인",
    #"남성 부 불임 원인",
    #"여성 주 불임 원인",
    #"여성 부 불임 원인",
    #"부부 주 불임 원인",
    #"부부 부 불임 원인",
    "불명확 불임 원인",
    "불임 원인 - 난관 질환", 
    #"불임 원인 - 남성 요인",
    "불임 원인 - 배란 장애",
    "불임 원인 - 여성 요인",
    "불임 원인 - 자궁경부 문제",
    "불임 원인 - 자궁내막증",
    "IVF 출산 횟수",
    "DI 출산 횟수", 
    #"불임 원인 - 정자 농도",
    #"불임 원인 - 정자 면역학적 요인",
    #"불임 원인 - 정자 운동성",
    #"불임 원인 - 정자 형태",
    "총 시술 횟수",
    #"클리닉 내 총 시술 횟수",
    "IVF 시술 횟수",
    "DI 시술 횟수",
    "총 생성 배아 수",
    "미세주입된 난자 수",
    "미세주입에서 생성된 배아 수",
    "이식된 배아 수",
    "미세주입 배아 이식 수",
    "저장된 배아 수",
    "미세주입 후 저장된 배아 수",
    "해동된 배아 수",
    "해동 난자 수",
    "수집된 신선 난자 수", 
    "저장된 신선 난자 수",
    "혼합된 난자 수",
    "파트너 정자와 혼합된 난자 수",
    "기증자 정자와 혼합된 난자 수",
    "난자 출처",
    "정자 출처",
    "난자 기증자 나이",
    "정자 기증자 나이",
    "동결 배아 사용 여부",
    "신선 배아 사용 여부",
    "기증 배아 사용 여부",
    "대리모 여부",
    "PGD 시술 여부",
    "PGS 시술 여부",
    # "난자 채취 경과일", ##
    # "난자 해동 경과일", ##
    # "난자 혼합 경과일", 
    "배아 이식 경과일",
    #"배아 해동 경과일" ##

]



#"배아 생성 주요 이유"
FEATURES_FOR_IVF = [
    "시술 시기 코드", ##
    "시술 당시 나이", 
    "임신 시도 또는 마지막 임신 경과 연수",
    "시술 유형",
    "특정 시술 유형",
    "배란 자극 여부",
    "단일 배아 이식 여부",
    "착상 전 유전 검사 사용 여부",
    "착상 전 유전 진단 사용 여부",
    #"남성 주 불임 원인",
    "남성 부 불임 원인",
    #"여성 주 불임 원인",
    "여성 부 불임 원인",
    #"부부 주 불임 원인",
    "부부 부 불임 원인",
    #"불명확 불임 원인",
    #"불임 원인 - 난관 질환", 
    "불임 원인 - 남성 요인",
    "불임 원인 - 배란 장애",
    #"불임 원인 - 여성 요인",
    #"불임 원인 - 자궁경부 문제",
    "불임 원인 - 자궁내막증", 
    #"불임 원인 - 정자 농도",
    #"불임 원인 - 정자 면역학적 요인",
    #"불임 원인 - 정자 운동성",
    "불임 원인 - 정자 형태",
    "IVF 임신 횟수",
    "DI 임신 횟수",
    #"총 시술 횟수",
    #"클리닉 내 총 시술 횟수",
    "IVF 시술 횟수",
    "DI 시술 횟수",
    "총 생성 배아 수",
    "미세주입된 난자 수",
    #"미세주입에서 생성된 배아 수",
    "이식된 배아 수",
    "미세주입 배아 이식 수",
    "저장된 배아 수",
    "미세주입 후 저장된 배아 수",
    "해동된 배아 수",
    "해동 난자 수",
    "수집된 신선 난자 수", 
    #"저장된 신선 난자 수",
    #"혼합된 난자 수",
    "파트너 정자와 혼합된 난자 수",
    #"기증자 정자와 혼합된 난자 수",
    #"난자 출처",
    "정자 출처",
    "난자 기증자 나이",
    "정자 기증자 나이",
    "동결 배아 사용 여부",
    "신선 배아 사용 여부",
    #"기증 배아 사용 여부",
    "총 출산 횟수",
    "대리모 여부",
    #"PGD 시술 여부",
    #"PGS 시술 여부",
    # "난자 채취 경과일", ##
    # "난자 해동 경과일", ##
    # "난자 혼합 경과일", 
    "배아 이식 경과일",
    # "배아 해동 경과일" ##

]


#"배아 생성 주요 이유"
FEATURES_FOR_DI = [
    "시술 시기 코드",  ##
    "시술 당시 나이",
    "임신 시도 또는 마지막 임신 경과 연수",
    "시술 유형",
    "특정 시술 유형",
    "배란 자극 여부",
    "단일 배아 이식 여부", ##
    "착상 전 유전 검사 사용 여부", ##
    "착상 전 유전 진단 사용 여부", ##
    "남성 주 불임 원인",
    "남성 부 불임 원인",
    "여성 주 불임 원인",
    "여성 부 불임 원인",
    "부부 주 불임 원인",
    "부부 부 불임 원인",
    "불명확 불임 원인",
    "불임 원인 - 난관 질환",
    "불임 원인 - 남성 요인",
    "불임 원인 - 배란 장애",
    "불임 원인 - 여성 요인",
    "불임 원인 - 자궁경부 문제",
    "불임 원인 - 자궁내막증", 
    "불임 원인 - 정자 농도",
    "불임 원인 - 정자 면역학적 요인",
    "불임 원인 - 정자 운동성",
    "불임 원인 - 정자 형태",
    #"총 시술 횟수",
    "클리닉 내 총 시술 횟수",
    "IVF 시술 횟수",
    "DI 시술 횟수",
    # "총 생성 배아 수", ##
    # "미세주입된 난자 수", ##
    # "미세주입에서 생성된 배아 수", ##
    # "이식된 배아 수", ##
    # "미세주입 배아 이식 수", ##
    # "저장된 배아 수", ##
    # "미세주입 후 저장된 배아 수", ##
    # "해동된 배아 수", ##
    # "해동 난자 수", ##
    # "수집된 신선 난자 수", ##
    # "저장된 신선 난자 수", ##
    # "혼합된 난자 수", ##
    # "파트너 정자와 혼합된 난자 수", ##
    # "기증자 정자와 혼합된 난자 수", ##
    # "난자 출처",
    # "정자 출처",
    # "난자 기증자 나이",
    # "정자 기증자 나이",
    # "동결 배아 사용 여부", ##
    # "신선 배아 사용 여부", ##
    # "기증 배아 사용 여부", ##
    # "대리모 여부", ##
    # "PGD 시술 여부", ##
    # "PGS 시술 여부", ##
    # "난자 채취 경과일", ##
    # "난자 해동 경과일", ##
    # "난자 혼합 경과일", ##
    # "배아 이식 경과일", ##
    # "배아 해동 경과일" ##

]

# feature for xgb
# FEATURES_FOR_IVF = [
#     "시술 시기 코드", ##
#     "시술 당시 나이", 
#     #"임신 시도 또는 마지막 임신 경과 연수",
#     #"시술 유형",
#     "특정 시술 유형",
#     #"배란 자극 여부",
#     "단일 배아 이식 여부",
#     #"착상 전 유전 검사 사용 여부",
#     "착상 전 유전 진단 사용 여부",
#     "남성 주 불임 원인",
#     #"남성 부 불임 원인",
#     #"여성 주 불임 원인",
#     "여성 부 불임 원인",
#     "부부 주 불임 원인",
#     #"부부 부 불임 원인",
#     #"불명확 불임 원인",
#     "불임 원인 - 난관 질환", 
#     "불임 원인 - 남성 요인",
#     "불임 원인 - 배란 장애",
#     #"불임 원인 - 여성 요인",
#     #"불임 원인 - 자궁경부 문제",
#     "불임 원인 - 자궁내막증", 
#     "불임 원인 - 정자 농도",
#     #"불임 원인 - 정자 면역학적 요인",
#     #"불임 원인 - 정자 운동성",
#     #"불임 원인 - 정자 형태",
#     "총 시술 횟수",
#     "클리닉 내 총 시술 횟수",
#     "IVF 시술 횟수",
#     "DI 시술 횟수",
#     "총 생성 배아 수",
#     #"미세주입된 난자 수",
#     "미세주입에서 생성된 배아 수",
#     "이식된 배아 수",
#     "미세주입 배아 이식 수",
#     "저장된 배아 수",
#     "미세주입 후 저장된 배아 수",
#     "해동된 배아 수",
#     "해동 난자 수",
#     "수집된 신선 난자 수", 
#     "저장된 신선 난자 수",
#     "혼합된 난자 수",
#     "파트너 정자와 혼합된 난자 수",
#     "기증자 정자와 혼합된 난자 수",
#     "난자 출처",
#     "정자 출처",
#     "난자 기증자 나이",
#     "정자 기증자 나이",
#     "동결 배아 사용 여부",
#     "신선 배아 사용 여부",
#     "기증 배아 사용 여부",
#     "대리모 여부",
#     "PGD 시술 여부",
#     "PGS 시술 여부",
#     "난자 채취 경과일", ##
#     "난자 해동 경과일", ##
#     "난자 혼합 경과일", 
#     "배아 이식 경과일",
#     "배아 해동 경과일" ##

# ]


# #"배아 생성 주요 이유"
# FEATURES_FOR_DI = [
#     "시술 시기 코드",  ##
#     "시술 당시 나이",
#     "임신 시도 또는 마지막 임신 경과 연수",
#     "시술 유형",
#     #"특정 시술 유형",
#     "배란 자극 여부",
#     "단일 배아 이식 여부", ##
#     "착상 전 유전 검사 사용 여부", ##
#     "착상 전 유전 진단 사용 여부", ##
#     "남성 주 불임 원인",
#     #"남성 부 불임 원인",
#     "여성 주 불임 원인",
#     "여성 부 불임 원인",
#     "부부 주 불임 원인",
#     "부부 부 불임 원인",
#     "불명확 불임 원인",
#     #"불임 원인 - 난관 질환",
#     #"불임 원인 - 남성 요인",
#     #"불임 원인 - 배란 장애",
#     #"불임 원인 - 여성 요인",
#     #"불임 원인 - 자궁경부 문제",
#     #"불임 원인 - 자궁내막증", 
#     #"불임 원인 - 정자 농도",
#     #"불임 원인 - 정자 면역학적 요인",
#     #"불임 원인 - 정자 운동성",
#     #"불임 원인 - 정자 형태",
#     "총 시술 횟수",
#     "클리닉 내 총 시술 횟수",
#     "IVF 시술 횟수",
#     #"DI 시술 횟수",
#     # "총 생성 배아 수", ##
#     # "미세주입된 난자 수", ##
#     # "미세주입에서 생성된 배아 수", ##
#     # "이식된 배아 수", ##
#     # "미세주입 배아 이식 수", ##
#     # "저장된 배아 수", ##
#     # "미세주입 후 저장된 배아 수", ##
#     # "해동된 배아 수", ##
#     # "해동 난자 수", ##
#     # "수집된 신선 난자 수", ##
#     # "저장된 신선 난자 수", ##
#     # "혼합된 난자 수", ##
#     # "파트너 정자와 혼합된 난자 수", ##
#     # "기증자 정자와 혼합된 난자 수", ##
#     "난자 출처",
#     "정자 출처",
#     "난자 기증자 나이",
#     "정자 기증자 나이",
#     # "동결 배아 사용 여부", ##
#     # "신선 배아 사용 여부", ##
#     # "기증 배아 사용 여부", ##
#     # "대리모 여부", ##
#     # "PGD 시술 여부", ##
#     # "PGS 시술 여부", ##
#     # "난자 채취 경과일", ##
#     # "난자 해동 경과일", ##
#     # "난자 혼합 경과일", ##
#     # "배아 이식 경과일", ##
#     "배아 해동 경과일" ##

# ]


MODEL_FOR_IVF = "LGB"   # or "MLP", "LGB", etc.
MODEL_FOR_DI  = "LGB"   # 예: DI는 MLP 모델




########################
# 모델 학습 관련 설정  #
########################
SEED = 42
SAVE_EPOCH = 1
EPOCHS = 200    #MLP
BATCH_SIZE = 32
VALIDATION_SPLIT = 0.2

# MLP
MLP_LEARNING_RATE = 1e-4
MLP_OPTIMIZER = "adam" 
MLP_HIDDEN_UNITS = [64, 32]
MLP_DROPOUT = 0.2

# XGBoost
XGB_PARAMS_IVF = {
    "n_estimators": 827,
    "max_depth": 4,
    "learning_rate": 0.025077202800209145,
    "subsample": 0.7156956442226219,
    "colsample_bytree": 0.8985229062541794,
    "min_child_weight": 7,
    "gamma": 2.134876950939452,
    "alpha": 0.00012886320857301013,
    "early_stopping_rounds" : 50
}

XGB_PARAMS_DI = {
    "n_estimators": 251,
    "max_depth": 4,
    "learning_rate": 0.22567561698723326,
    "subsample": 0.8650656005053031,
    "colsample_bytree": 0.8337507048692727,
    "min_child_weight": 9,
    "gamma": 2.1664818875892355,
    "alpha": 5.567841518475384e-06,
    "early_stopping_rounds" : 50
}


# LightGBM
LGB_PARAMS_IVF = {
    "n_estimators": 928,
    "learning_rate": 0.047152329458534314,
    "num_leaves": 51,
    "max_depth": 7,
    "min_child_samples": 37,
    "subsample": 0.7959457478394651,
    "colsample_bytree": 0.48631381175426086,
    "reg_alpha": 4.931862586746873e-07,
    "reg_lambda": 4.123479143917025e-06,
    "min_split_gain": 0.17301732240216539,
    "min_child_weight": 2.4686257922819816,
    
    "objective": "binary",
    "metric": "auc",
    "random_state": SEED,
    "verbosity": -1,
    "early_stopping_rounds": 100
}



# LightGBM
LGB_PARAMS_DI = {
    "n_estimators": 123,
    "learning_rate": 0.1745120190360639,
    "num_leaves": 136,
    "max_depth": 4,
    "min_child_samples": 61,
    "subsample": 0.5566790939522344,
    "colsample_bytree": 0.9210670348327551,
    "reg_alpha": 3.81385599741023e-07,
    "reg_lambda": 4.5273471188806334e-05,
    "min_split_gain": 0.022909600962271064,
    "min_child_weight": 0.0011446491206325733,
    
    "objective": "binary",
    "metric": "auc",
    "random_state": SEED,
    "verbosity": -1,
    "early_stopping_rounds": 100
}


LGB_PARAMS_ALL = {

    "n_estimators" : 778,
    "learning_rate" : 0.03159784160824437,
    "num_leaves": 76,
    "max_depth" : 6,
    "min_child_samples" : 88,
    "subsample" : 0.6971959040390706,
    "colsample_bytree" : 0.9990684007607449,
    "reg_alpha" : 0.01834215640537935,
    "reg_lambda" : 0.000210958850611292,
    "min_split_gain" : 0.0006902075163875178,
    "min_child_weight" : 0.19328366758122323,
    
    "objective": "binary",
    "metric": "auc",
    "random_state": SEED,
    "verbosity": -1,
    "early_stopping_rounds" : 100
}




XGB_EVAL_METRIC = "auc"



#######################
# 결과 저장 관련 설정 #
#######################
RESULT_DIR = "results"
WEIGHTS_DIR = "results/weights"
RESULT_FIG_PREFIX = "training_curve"
